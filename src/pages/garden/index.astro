---
import { getCollection } from "astro:content";
import BaseMain from "~/components/layout/BaseMain.astro";
import NoteCard from "~/components/styled/monom/note/NoteCard.astro";
import TagWIcon from "~/components/styled/polym/TagWIcon.astro";
import { NAV_LINKS } from "~/data/links";
import { getNoteName, gnr } from "~/utils/post";
import Collections from "./_Collections.astro";
import Featured from "./_Featured.astro";
import { Content as GardenIntroContent } from "./_garden-intro.mdx";

const publicNotes = await getCollection("obsidian-note");

const leafNotes = publicNotes
  .filter((n) => !n.data.tags?.includes("📂/collection"))
  .sort((a, b) => (a.body.length < b.body.length ? 1 : -1));

const allCollections = publicNotes
  .filter((n) => n.data.tags?.includes("📂/collection"))
  .sort((a, b) =>
    (a.data.collectionItems as any).length <
    (b.data.collectionItems as any).length
      ? 1
      : -1
  );


const icon = NAV_LINKS.GARDEN.icon;

// featured
// Pinned
// Latest Now

// Recently Published
// Recently Edited
// All now's
---

<BaseMain title="Digital Garden" class="linew-wide">
  <article class="flow-2xl prose">
    <TagWIcon iconName={icon} as="h1" style={{ gridColumn: "1/-1" }}
      >Caleb's Digital Garden</TagWIcon
    >
    <div
      class="flow garden-intro flom-lg"
      style={{ gridColumn: "span 2 / span 2" }}
    >
      <GardenIntroContent />
    </div>
    <div class="flow flom-lg" style={{ gridColumn: "span 1 / span 1" }}>
      <h2 class="start-here-title">📍 Start Here</h2>
      <ul>
        <li><b>🚧 WIP</b></li>
        <li>What's the Garden About?</li>
        <li>How To Use This Site</li>
      </ul>
    </div>
    <section class="flow-lg" style={{ gridColumn: "1/-1" }}>
      <h2>✨ Featured</h2>
      <Featured />
    </section>
    <section class="flow-lg" style={{ gridColumn: "1/-1" }}>
      <h2>📂 All Collections</h2>
      <Collections collections={allCollections} />
    </section>
    <section class="prose flow-lg" style={{ gridColumn: "1/-1" }}>
      <h2>🍃 Leaf notes</h2>
      <ul class="flow-li-0 leaf-ul">
        {
          leafNotes?.map((n) => (
            <li>
              <NoteCard as="a" href={gnr(n.slug)}>
                <h3>{getNoteName(n.id)}</h3>
                <div class="metadata">𝑥 months ago</div>
              </NoteCard>
            </li>
          ))
        }
      </ul>
    </section>
  </article>
</BaseMain>

  <style>
    * :global(p) {
      max-width: var(--content-w);
    }
    .start-here-title {
      font-size: var(--step-2);
    }
    article {
      display: grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      row-gap: var(--space-xs);
      @media (width > 900px) {
        grid-template-columns: repeat(3, 1fr);
        column-gap: var(--space-m);
      }
    }

    .leaf-ul {
      display: grid;
      grid-template-columns: repeat(
        auto-fit,
        minmax(var(--size-content-1), var(--size-content-2))
      );
      column-gap: var(--space-l);
      row-gap: var(--space-s);
    }
  </style>

