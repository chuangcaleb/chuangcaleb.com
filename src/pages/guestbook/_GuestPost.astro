---
import { parse } from "date-fns";
import type { GuestPost } from "lib/google/sheets/types";
import ProseA from "~/components/styled/monom/ProseA.astro";
import { formatIso } from "~/utils/time";

interface Props {
  post: GuestPost;
}

const { post } = Astro.props;

const hasLink = !!post["ğŸ”— Social Link"];

const formattedDate = formatIso(
  parse(post.Timestamp, "dd/MM/yyyy HH:mm:ss", new Date()).toISOString(),
  "MMMM yyyy"
);
---

<blockquote class="flom-lg surface-alt border flow">
  <div class="cite | flex-row">
    {
      post["ğŸ“¸ Avatar Image Link"] && (
        <img
          src={post["ğŸ“¸ Avatar Image Link"]}
          alt={`Avatar image of ${post["ğŸ“‡ Display Name"]}`}
          height={40}
          width={40}
          fetchpriority="low"
          loading="lazy"
        />
      )
    }
    <p>
      {
        hasLink ? (
          <ProseA href={post["ğŸ”— Social Link"]}>
            {post["ğŸ“‡ Display Name"]}
          </ProseA>
        ) : (
          <span>{post["ğŸ“‡ Display Name"]}</span>
        )
      }
      <span class="flex-row subtitle">
        <span>{post["ğŸ‘¥ Relation to me"]}</span>
        {post["ğŸ·ï¸ Tag"] !== "Other" && <i class="tag">#{post["ğŸ·ï¸ Tag"]}</i>}
      </span>
    </p>
  </div>
  <p class="body">
    {post["ğŸ“ƒ Content Body"]}
    <i>
      {formattedDate}
    </i>
  </p>

  <style>
    blockquote *:not(.body) {
      font-size: var(--step--1);
    }
    img {
      /* height: 3em; */
      /* aspect-ratio: 1/1; */
      border-radius: 100%;
    }
    .cite p > span {
      line-height: var(--font-lh-1);
    }
    i,
    .subtitle {
      color: var(--fg3);
      white-space: nowrap;
    }
    .subtitle {
      text-transform: lowercase;
    }
    p {
      word-wrap: initial;
    }
  </style>
</blockquote>
