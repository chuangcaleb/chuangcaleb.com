---
import { parse } from "date-fns";
import type { GuestPost } from "lib/google-sheets/types";
import { formatIso } from "~/utils/time";

interface Props {
  post: GuestPost;
}

const { post } = Astro.props;

const hasAvatar = !!post["ðŸ“¸ Avatar Image Link"];
const hasLink = !!post["ðŸ”— Social Link"];

const formattedDate = formatIso(
  parse(post.Timestamp, "dd/MM/yyyy HH:mm:ss", new Date()).toISOString(),
  "MMMM yyyy"
);
---

<blockquote class="flom-lg surface-alt border flow">
  <div class="cite | flex-row">
    {
      hasAvatar && (
        <img
          src={post["ðŸ“¸ Avatar Image Link"]}
          fetchpriority="low"
          loading="lazy"
        />
      )
    }
    <p>
      {
        hasLink ? (
          <a href={post["ðŸ”— Social Link"]}>{post["ðŸ“‡ Display Name"]}</a>
        ) : (
          <span>{post["ðŸ“‡ Display Name"]}</span>
        )
      }
      <span><i>{post["ðŸ‘¥ Relation to me"]}</i></span>
    </p>
  </div>
  <p class="body">
    {post["ðŸ“ƒ Content Body"]}
    <i>
      {formattedDate}
    </i>
  </p>

  <style>
    blockquote *:not(.body) {
      font-size: var(--step--1);
    }
    img {
      height: 3em;
      border-radius: 100%;
    }
    .cite p span {
      display: block;
      line-height: var(--font-lineheight-1);
    }
    i {
      color: var(--fg3);
      white-space: nowrap;
    }
    p {
      word-wrap: initial;
    }
  </style>
</blockquote>
