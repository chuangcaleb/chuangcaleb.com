---
import NoteListItems from "~/components/block/note/NoteListItems.astro";
import BaseMain from "~/components/layout/BaseMain.astro";
import TagWIcon from "~/components/styled/polym/TagWIcon.astro";
import { NAV_LINKS } from "~/data/links";
import { getAllNotes } from "~/utils/note";
import Featured from "./_components/Featured.astro";
import { Content as GardenIntroContent } from "./_components/garden-intro.mdx";
import Topics from "./_components/Topics.astro";
import { modifiedMeta } from "./recently-modified/meta";
import { publishedMeta } from "./recently-published/meta";

const allNotes = await getAllNotes();

const topLevelTopics = allNotes
  .filter((n) => n.data.emojip && n.data.up?.length === 0)
  .sort((a, b) => (b.data.featured ?? 0) - (a.data.featured ?? 0));

const icon = NAV_LINKS.GARDEN.icon;

const description =
  "Like a blog, but more ğŸ¬ fluid. I like to yap about ğŸ­ narrative storytelling and sometimes ğŸ’» tech stuff, and perhaps you like to listen to yapping...";

// featured
// Pinned
// Latest Now

// Recently Published
// Recently Edited
// All now's

const startHereNotes = [
  {
    id: "digital-garden-design-principles",
    collection: "obsidian-note",
  } as const,
  {
    id: "public-digital-garden-terms-of-service",
    collection: "obsidian-note",
  } as const,
];
---

<BaseMain title="Digital Garden" description={description} class="linew-wide">
  <article class="flow-xl">
    <header class="flow-xl prose">
      <TagWIcon iconName={icon} as="h1" style={{ gridArea: "t" }}>
        Caleb's Digital Garden
      </TagWIcon>
      <div class="flow garden-intro flom-lg" style={{ gridArea: "i" }}>
        <GardenIntroContent />
      </div>
      <div class="flow-lg flom-lg start-here-section" style={{ gridArea: "s" }}>
        <h2 class="start-here-title">ğŸ“ Why not call it a blog?</h2>
        <ul class="flow">
          <NoteListItems references={startHereNotes} />
        </ul>
      </div>
    </header>
    <section class="flow-xl region">
      <h2>âœ¨ Featured</h2>
      <Featured />
    </section>
    <section class="flow-xl region">
      <h2>ğŸ“‚ Top-Level Topic Notes</h2>
      <Topics topics={topLevelTopics} />
    </section>
    <section class="flow-xl">
      <h2>{publishedMeta.heading}</h2>
      <ol class="">
        <NoteListItems references={publishedMeta.fn(allNotes).slice(0, 5)} />
      </ol>
    </section>
    <section class="flow-xl">
      <h2>{modifiedMeta.heading}</h2>
      <ol class="">
        <NoteListItems references={modifiedMeta.fn(allNotes).slice(0, 5)} />
      </ol>
    </section>
  </article>
</BaseMain>

<style>
  .start-here-title {
    font-size: var(--step-2);
  }
  header {
    display: grid;
    grid-template: "t" "i" "s";
    padding-block: var(--space-l);
    row-gap: var(--space-xs);
  }
  @media (width > 900px) {
    header {
      grid-template:
        "t t t s s"
        "i i i s s" / 1fr 1fr 1fr 1fr 1fr;
      column-gap: var(--space-xl);
    }
  }

  ol {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(30ch, 1fr));
    grid-template-rows: repeat(auto-fit, 1fr);
    row-gap: var(--space-m);
    column-gap: var(--space-s);
  }
</style>
