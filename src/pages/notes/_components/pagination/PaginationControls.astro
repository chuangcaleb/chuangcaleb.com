---
import { Icon } from "astro-icon/components";
import PaginationCrumb from "./PaginationCrumb.astro";

/**
 * InfiniteScrollPaginator - Pagination controls component
 *
 * Renders pagination buttons that use View Transitions API for smooth navigation.
 * Updates URL query params (?page=1) to track current page without full page reload.
 *
 * Props:
 * - currentPage: Current page number (1-indexed)
 * - totalPages: Total number of pages
 * - totalItems: Total count of items
 * - pageSize: Items per page
 * - section: Optional section identifier for query param (e.g., "published", "modified")
 */

interface Props {
  currentPage: number;
  section?: string;
  totalItems: number;
  totalPages: number;
}

const { currentPage, section, totalItems, totalPages } = Astro.props;

const hasNext = currentPage < totalPages;
const hasPrevious = currentPage > 1;

// which query param do we use for this section? publishedPage for normal,
// modifiedPage for the modified section.

// helper to build a relative href preserving other params
function makeHref(page: number) {
  const params = new URLSearchParams(Astro.url.searchParams);
  params.set("page", String(page));
  return `?${params.toString()}`;
}
---

<nav
  aria-label={`${section ? `${section} ` : ""}notes pagination`}
  class="pagination-controls"
  data-paginator
>
  {/* Previous page link */}
  {
    hasPrevious ? (
      <a
        href={makeHref(currentPage - 1)}
        aria-label="Previous page"
        class="pagination-button prev-button"
      >
        <Icon name="lucide:arrow-left" /> Previous
      </a>
    ) : (
      <span class="pagination-button prev-button" aria-disabled="true">
        <Icon name="lucide:arrow-left" /> Previous
      </span>
    )
  }

  {/* Page info */}
  <PaginationCrumb
    currentPage={currentPage}
    totalPages={totalPages}
    totalItems={totalItems}
  />

  {/* Next page link */}
  {
    hasNext ? (
      <a
        href={makeHref(currentPage + 1)}
        aria-label="Next page"
        class="pagination-button next-button"
      >
        Next <Icon name="lucide:arrow-right" />
      </a>
    ) : (
      <span class="pagination-button next-button" aria-disabled="true">
        Next <Icon name="lucide:arrow-right" />
      </span>
    )
  }
</nav>

<style>
  .pagination-button {
    display: flex;
    align-items: center;
    gap: var(--space-2xs);
    text-decoration: none;
    transition:
      background-color 0.2s,
      color 0.2s;

    &:not([aria-disabled="true"]):hover {
      color: var(--text-accent);
    }

    &[aria-disabled="true"] {
      cursor: not-allowed;
      color: var(--text-muted);
      /* visibility: hidden; */
    }
  }

  .pagination-controls {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-m);
    justify-content: center;
    padding-block: var(--space-m);
    font-size: var(--step--1);
  }
</style>
